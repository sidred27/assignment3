function AnuguGalleryImagesUpdate(e){AnuguGalleryImages.reset();var a="ul#anugu-gallery-output li.anugu-gallery-image"+(e?".selected":"");jQuery(a).each(function(){var e=jQuery.parseJSON(jQuery(this).attr("data-anugu-gallery-image-model"));e.alt=AnuguGalleryStripslashes(e.alt),AnuguGalleryImages.add(new AnuguGalleryImage(e))}),jQuery("#anugu-gallery-main span.count").text(jQuery("ul#anugu-gallery-output li.anugu-gallery-image").length)}function AnuguGalleryStripslashes(e){return(e+"").replace(/\\(.?)/g,function(e,a){switch(a){case"\\":return"\\";case"0":return"\x00";case"":return"";default:return a}})}function anugu_gallery_sortable($){$(anugu_gallery_output).sortable({containment:anugu_gallery_output,items:"li",cursor:"move",forcePlaceholderSize:!0,placeholder:"dropzone",helper:function(e,a){a.hasClass("selected")||a.addClass("selected").siblings().removeClass("selected");var t=a.parent().children(".selected").clone();a.data("multidrag",t).siblings(".selected").remove();var i=$("<li/>");return i.append(t)},stop:function(e,a){var t=a.item.data("multidrag");a.item.after(t).remove(),$("li.selected",$(anugu_gallery_output)).removeClass("selected"),$.ajax({url:anugu_gallery_metabox.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"anugu_gallery_sort_images",order:$(anugu_gallery_output).sortable("toArray").toString(),post_id:anugu_gallery_metabox.id,nonce:anugu_gallery_metabox.sort},success:function(e){AnuguGalleryImagesUpdate(!1)},error:function(e,a,t){$(anugu_gallery_output).before('<div class="error"><p>'+a.responseText+"</p></div>")}})}})}jQuery(document).ready(function($){});var anugu_video_link="p.anugu-intro a.anugu-video",anugu_close_video_link="a.anugu-video-close";jQuery(document).ready(function($){$(document).on("click",anugu_video_link,function(e){e.preventDefault();var a=$(this).attr("href");-1==a.search("autoplay=1")&&(a+=-1==a.search("rel=")?"?rel=0&autoplay=1":"&autoplay=1"),$("div.anugu-video-help").remove();var t=$(this).closest("p.anugu-intro");$(t).append('<div class="anugu-video-help"><iframe src="'+a+'" /><a href="#" class="anugu-video-close dashicons dashicons-no"></a></div>')}),$(document).on("click",anugu_close_video_link,function(e){e.preventDefault(),$(this).closest(".anugu-video-help").remove()})}),jQuery(document).ready(function($){$(document).on("click","a.anugu-gallery-images-delete",function(e){e.preventDefault();var a=confirm(anugu_gallery_metabox.remove_multiple);if(!a)return!1;var t=[];$("ul#anugu-gallery-output > li.selected").each(function(){t.push($(this).attr("id"))});var i=$(this).parent().attr("id");$.ajax({url:anugu_gallery_metabox.ajax,type:"post",dataType:"json",data:{action:"anugu_gallery_remove_images",attachment_ids:t,post_id:anugu_gallery_metabox.id,nonce:anugu_gallery_metabox.remove_nonce},success:function(e){$("ul#anugu-gallery-output > li.selected").remove(),$("nav.anugu-select-options").fadeOut(),$(".anugu-gallery-load-library").attr("data-anugu-gallery-offset",0).addClass("has-search").trigger("click"),AnuguGalleryImagesUpdate(!1)},error:function(e,a,t){$(anugu_gallery_output).before('<div class="error"><p>'+a.responseText+"</p></div>")}})}),$(document).on("click","#anugu-gallery-main .anugu-gallery-remove-image",function(e){e.preventDefault();var a=confirm(anugu_gallery_metabox.remove);if(a){var t=$(this).parent().attr("id");$.ajax({url:anugu_gallery_metabox.ajax,type:"post",dataType:"json",data:{action:"anugu_gallery_remove_image",attachment_id:t,post_id:anugu_gallery_metabox.id,nonce:anugu_gallery_metabox.remove_nonce},success:function(e){$("#"+t).fadeOut("normal",function(){$(this).remove(),$(".anugu-gallery-load-library").attr("data-anugu-gallery-offset",0).addClass("has-search").trigger("click"),AnuguGalleryImagesUpdate(!1)})},error:function(e,a,t){$(anugu_gallery_output).before('<div class="error"><p>'+a.responseText+"</p></div>")}})}})});var AnuguGalleryImage=Backbone.Model.extend({defaults:{id:"",title:"",caption:"",alt:"",link:""}}),AnuguGalleryImages=new Backbone.Collection;if("undefined"==typeof AnuguGalleryModalWindow)var AnuguGalleryModalWindow=new wp.media.view.Modal({controller:{trigger:function(){}}});var AnuguGalleryEditView=wp.Backbone.View.extend({tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("anugu-meta-editor"),events:{"click .edit-media-header .left":"loadPreviousItem","click .edit-media-header .right":"loadNextItem","keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","blur textarea":"updateItem","change select":"updateItem","click .actions a.anugu-gallery-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.on("loading",this.loading,this),this.on("loaded",this.loaded,this),this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.attachment_id=e.attachment_id,this.attachment_index=0,this.search_timer="";var a=0;this.collection.each(function(e){return e.get("id")==this.attachment_id?(this.model=e,this.attachment_index=a,!1):void a++},this)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.child_views.length>0&&this.child_views.forEach(function(e){var a=new e({model:this.model});this.$el.find("div.anugu-addons").append(a.render().el)},this),this.$el.find("textarea[name=caption]").val(this.model.get("caption")),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),wpLink.init,0==this.attachment_index&&this.$el.find("button.left").addClass("disabled"),this.attachment_index==this.collection.length-1&&this.$el.find("button.right").addClass("disabled"),this},renderError:function(e){var a={};a.error=e;var t=new wp.media.view.AnuguGalleryError({model:a});return t.render().el},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),"undefined"!=typeof e&&this.$el.find("div.media-toolbar").after(this.renderError(e))},loadPreviousItem:function(){this.attachment_index--,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},loadNextItem:function(){this.attachment_index++,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},updateItem:function(e){""!=e.target.name&&("checkbox"==e.target.type?value=e.target.checked?e.target.value:0:value=e.target.value,this.model.set(e.target.name,value))},saveItem:function(e){e.preventDefault(),this.trigger("loading"),wp.media.ajax("anugu_gallery_save_meta",{context:this,data:{nonce:anugu_gallery_metabox.save_nonce,post_id:anugu_gallery_metabox.id,attach_id:this.model.get("id"),meta:this.model.attributes},success:function(e){this.trigger("loaded loaded:success");var a=JSON.stringify(this.model.attributes),t=jQuery("ul#anugu-gallery-output li#"+this.model.get("id"));jQuery(t).attr("data-anugu-gallery-image-model",a),jQuery("div.meta div.title span",t).text(this.model.get("title")),jQuery("div.meta div.title a.hint",t).attr("title",this.model.get("title")),this.model.get("title").length>20?jQuery("div.meta div.title a.hint",t).removeClass("hidden"):jQuery("div.meta div.title a.hint",t).addClass("hidden");var i=this.$el.find(".saved");i.fadeIn(),setTimeout(function(){i.fadeOut()},1500)},error:function(e){this.trigger("loaded loaded:error",e)}})},searchLinks:function(e){},insertLink:function(e){},insertMediaFileLink:function(e){this.trigger("loading"),wp.media.ajax("anugu_gallery_get_attachment_links",{context:this,data:{nonce:anugu_gallery_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.media_link),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertAttachmentPageLink:function(e){this.trigger("loading"),wp.media.ajax("anugu_gallery_get_attachment_links",{context:this,data:{nonce:anugu_gallery_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.attachment_page),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})}}),AnuguGalleryChildViews=[];jQuery(document).ready(function($){$(document).on("click","#anugu-gallery-main a.anugu-gallery-modify-image",function(e){e.preventDefault(),AnuguGalleryImagesUpdate(!1);var a=$(this).parent().data("anugu-gallery-image");AnuguGalleryModalWindow.content(new AnuguGalleryEditView({collection:AnuguGalleryImages,child_views:AnuguGalleryChildViews,attachment_id:a})),AnuguGalleryModalWindow.open()})}),jQuery(document).ready(function($){$("a.anugu-media-library").on("click",function(e){return e.preventDefault(),wp.media.frames.anugu?void wp.media.frames.anugu.open():(wp.media.frames.anugu=wp.media({frame:"post",title:wp.media.view.l10n.insertIntoPost,button:{text:wp.media.view.l10n.insertIntoPost},multiple:!0}),wp.media.frames.anugu.on("open",function(){var e=wp.media.frames.anugu.state().get("selection");$("ul#anugu-gallery-output li").each(function(){var a=wp.media.attachment($(this).attr("id"));e.add(a?[a]:[])})}),wp.media.frames.anugu.on("insert",function(e){var a=wp.media.frames.anugu.state(),t=[];e.each(function(e){var i=a.display(e).toJSON();switch(i.link){case"none":e.set("link",e.get("url"));break;case"file":e.set("link",e.get("url"));break;case"post":break;case"custom":e.set("link",i.linkUrl)}t.push(e.toJSON())},this),$(document).find(".anugu-progress-adding-images").css("display","block"),$.post(anugu_gallery_metabox.ajax,{action:"anugu_gallery_insert_images",nonce:anugu_gallery_metabox.insert_nonce,post_id:anugu_gallery_metabox.id,images:JSON.stringify(t)},function(e){e&&e.success&&($("#anugu-gallery-output").html(e.success),AnuguGalleryImagesUpdate(!1),$(document).find(".anugu-progress-adding-images").css("display","none"))},"json")}),wp.media.frames.anugu.open(),$("div.media-menu a.media-menu-item:nth-child(2)").addClass("hidden"),void $("div.media-menu a.media-menu-item:nth-child(4)").addClass("hidden"))})});var anugu_gallery_output="#anugu-gallery-output",anugu_gallery_shift_key_pressed=!1,anugu_gallery_last_selected_image=!1;jQuery(document).ready(function($){$(document).on("click","nav.anugu-tab-options a",function(e){e.preventDefault();var a=$(this).closest(".anugu-tab-options"),t=$(this).data("view"),i=$(this).data("view-style");$(t).hasClass(i)||($(t).removeClass("list").removeClass("grid").addClass(i),$("a",a).removeClass("selected"),$(this).addClass("selected"),$.ajax({url:anugu_gallery_metabox.ajax,type:"post",dataType:"json",data:{action:"anugu_gallery_set_user_setting",name:"anugu_gallery_image_view",value:i,nonce:anugu_gallery_metabox.set_user_setting_nonce},success:function(e){},error:function(e,a,t){$(anugu_gallery_output).before('<div class="error"><p>'+a.responseText+"</p></div>")}}))}),$(document).on("change","nav.anugu-tab-options input",function(e){$(this).prop("checked")?($("li",$(anugu_gallery_output)).addClass("selected"),$("nav.anugu-select-options").fadeIn()):($("li",$(anugu_gallery_output)).removeClass("selected"),$("nav.anugu-select-options").fadeOut())}),anugu_gallery_sortable($),$(document).on("anuguGalleryType",function(){$(anugu_gallery_output).length>0&&anugu_gallery_sortable($)}),$(document).on("click","ul#anugu-gallery-output li.anugu-gallery-image > img, li.anugu-gallery-image > div, li.anugu-gallery-image > a.check",function(e){e.preventDefault();var a=$(this).parent();if($(a).hasClass("selected"))$(a).removeClass("selected"),anugu_gallery_last_selected_image=!1;else{if(anugu_gallery_shift_key_pressed&&anugu_gallery_last_selected_image!==!1){var t=$("ul#anugu-gallery-output li").index($(anugu_gallery_last_selected_image)),i=$("ul#anugu-gallery-output li").index($(a)),n=0;if(i>t)for(n=t;i>=n;n++)$("ul#anugu-gallery-output li:eq( "+n+")").addClass("selected");else for(n=i;t>=n;n++)$("ul#anugu-gallery-output li:eq( "+n+")").addClass("selected")}$(a).addClass("selected"),anugu_gallery_last_selected_image=$(a)}$("ul#anugu-gallery-output > li.selected").length>0?$("nav.anugu-select-options").fadeIn():$("nav.anugu-select-options").fadeOut()}),$(document).on("keyup keydown",function(e){anugu_gallery_shift_key_pressed=e.shiftKey})}),function($){$(function(){if("undefined"!=typeof uploader){$("input#plupload-browse-button").val(anugu_gallery_metabox.uploader_files_computer);var e=$("#anugu-gallery .anugu-progress-bar"),a=$("#anugu-gallery .anugu-progress-bar div.anugu-progress-bar-inner"),t=$("#anugu-gallery .anugu-progress-bar div.anugu-progress-bar-status"),i=$("#anugu-gallery-output"),n=$("#anugu-gallery-upload-error"),r=0;uploader.bind("Init",function(e){$("#drag-drop-area").fadeIn(),$("a.anugu-media-library.button").fadeIn()}),uploader.bind("FilesAdded",function(a,i){$(n).html(""),r=i.length,$(".uploading .current",$(t)).text("1"),$(".uploading .total",$(t)).text(r),$(".uploading",$(t)).show(),$(".done",$(t)).hide(),$(e).fadeIn("fast",function(){$("p.max-upload-size").css("padding-top","10px")})}),uploader.bind("UploadProgress",function(e,i){$(".uploading .current",$(t)).text(r-e.total.queued+1),$(a).css({width:e.total.percent+"%"})}),uploader.bind("FileUploaded",function(e,a,t){$.post(anugu_gallery_metabox.ajax,{action:"anugu_gallery_load_image",nonce:anugu_gallery_metabox.load_image,id:t.response,post_id:anugu_gallery_metabox.id},function(e){switch(anugu_gallery_metabox.media_position){case"before":$(i).prepend(e);break;case"after":default:$(i).append(e)}AnuguGalleryImagesUpdate(!1)},"json")}),uploader.bind("UploadComplete",function(){$(".uploading",$(t)).hide(),$(".done",$(t)).show(),setTimeout(function(){$(e).fadeOut("fast",function(){$("p.max-upload-size").css("padding-top","0")})},1e3)}),uploader.bind("Error",function(e,a){$("#anugu-gallery-upload-error").html('<div class="error fade"><p>'+a.file.name+": "+a.message+"</p></div>"),e.refresh()})}})}(jQuery);